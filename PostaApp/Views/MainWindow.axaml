<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:PostaApp.ViewModels"
        x:Class="PostaApp.MainWindow"
        x:DataType="vm:MainViewModel"
         Title="Magyar Posta - Csomagkezelő" Width="1000" Height="700"
        Background="#F4F4F9" WindowStartupLocation="CenterScreen">
    <Grid ColumnDefinitions="350, *" Margin="20">
        
        <!-- BAL OLDAL: ÚJ CSOMAG ÉS LISTA -->
        <Border Grid.Column="0" Background="White" CornerRadius="10" BoxShadow="0 4 10 0 #20000000" Margin="0,0,10,0">
            <DockPanel Margin="15">
                <TextBlock DockPanel.Dock="Top" Text="Új csomag feladása" FontSize="20" FontWeight="SemiBold" Margin="0,0,0,15" Foreground="#2E7D32"/>
                
                <StackPanel DockPanel.Dock="Top" Spacing="10">
                    <TextBox Watermark="Csomag elnevezése" Text="{Binding NewName}" Height="40" VerticalContentAlignment="Center"/>
                    <TextBox Watermark="Honnan (Város)" Text="{Binding NewOrigin}" Height="40" VerticalContentAlignment="Center"/>
                    <TextBox Watermark="Hová (Város)" Text="{Binding NewDestination}" Height="40" VerticalContentAlignment="Center"/>
                    
                    <Grid ColumnDefinitions="*, *" Margin="0,5">
                        <StackPanel Grid.Column="0" Margin="0,0,5,0">
                            <TextBlock Text="Ár (Ft):" FontSize="12" Foreground="Gray"/>
                            <NumericUpDown Value="{Binding NewPrice}" Minimum="1" FormatString="0"/>
                        </StackPanel>
                        <StackPanel Grid.Column="1" Margin="5,0,0,0">
                            <TextBlock Text="Napok:" FontSize="12" Foreground="Gray"/>
                            <NumericUpDown Value="{Binding NewDays}" Minimum="1"/>
                        </StackPanel>
                    </Grid>

                    <Button Content="Csomag Hozzáadása" 
                            Command="{Binding AddPackageCommand}" 
                            Background="#2E7D32" Foreground="White" 
                            HorizontalAlignment="Stretch" HorizontalContentAlignment="Center" 
                            Height="40" FontWeight="Bold" CornerRadius="5"/>
                </StackPanel>

                <Separator DockPanel.Dock="Top" Margin="0,20"/>

                <TextBlock DockPanel.Dock="Top" Text="Csomagok listája" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,10"/>
                <ListBox ItemsSource="{Binding Packages}" SelectedItem="{Binding SelectedPackage}" CornerRadius="5" Background="#FAFAFA">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Grid ColumnDefinitions="*, Auto">
                                <TextBlock Text="{Binding Name}" VerticalAlignment="Center" FontWeight="Medium"/>
                                <TextBlock Grid.Column="1" Text="{Binding Status}" FontSize="11" Foreground="Gray" VerticalAlignment="Center"/>
                            </Grid>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </DockPanel>
        </Border>

        <!-- JOBB OLDAL: SZERKESZTÉS ÉS RÉSZLETEK -->
        <Border Grid.Column="1" Background="White" CornerRadius="10" BoxShadow="0 4 10 0 #20000000" Margin="10,0,0,0">
            <Grid RowDefinitions="*, Auto">
                
                <!-- Üres állapot jelzése -->
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" 
                            IsVisible="{Binding SelectedPackage, Converter={x:Static ObjectConverters.IsNull}}">
                    <TextBlock Text="Válassz egy csomagot a listából a módosításhoz!" Foreground="Gray" FontSize="16"/>
                </StackPanel>

                <!-- Szerkesztő felület -->
                <ScrollViewer IsVisible="{Binding SelectedPackage, Converter={x:Static ObjectConverters.IsNotNull}}" Margin="30">
                    <StackPanel Spacing="20">
                        <TextBlock Text="Csomag részletei és módosítása" FontSize="24" FontWeight="Bold" Foreground="#1B5E20"/>
                        
                        <Grid ColumnDefinitions="180, *" RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto" Margin="0,10">
                            <!-- Nem módosítható adatok -->
                            <TextBlock Grid.Row="0" Text="Azonosító:" VerticalAlignment="Center" Foreground="Gray"/>
                            <SelectableTextBlock Grid.Row="0" Grid.Column="1" Text="{Binding SelectedPackage.Id}" VerticalAlignment="Center" FontWeight="Bold"/>

                            <TextBlock Grid.Row="1" Text="Feladás dátuma:" VerticalAlignment="Center" Foreground="Gray" Margin="0,15"/>
                            <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding SelectedPackage.ShipDate}" VerticalAlignment="Center"/>

                            <TextBlock Grid.Row="2" Text="Kiinduló város:" VerticalAlignment="Center" Foreground="Gray" Margin="0,15"/>
                            <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding SelectedPackage.OriginCity}" VerticalAlignment="Center"/>

                            <!-- Módosítható adatok -->
                            <TextBlock Grid.Row="3" Text="Elnevezés:" VerticalAlignment="Center"/>
                            <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding SelectedPackage.Name}" Margin="0,5"/>

                            <TextBlock Grid.Row="4" Text="Célállomás:" VerticalAlignment="Center"/>
                            <TextBox Grid.Row="4" Grid.Column="1" Text="{Binding SelectedPackage.DestinationCity}" Margin="0,5"/>

                            <TextBlock Grid.Row="5" Text="Állapot:" VerticalAlignment="Center"/>
                            <ComboBox Grid.Row="5" Grid.Column="1" ItemsSource="{Binding StatusOptions}" 
                                      SelectedItem="{Binding SelectedPackage.Status}" HorizontalAlignment="Stretch" Margin="0,5"/>

                            <TextBlock Grid.Row="6" Text="Ár / Hátralévő napok:" VerticalAlignment="Center"/>
                            <Grid Grid.Row="6" Grid.Column="1" ColumnDefinitions="*, *">
                                <NumericUpDown Grid.Column="0" Value="{Binding SelectedPackage.Price}" Minimum="1" Margin="0,5,5,5"/>
                                <NumericUpDown Grid.Column="1" Value="{Binding SelectedPackage.DaysUntilDelivery}" Minimum="0" Margin="5,5,0,5"/>
                            </Grid>
                        </Grid>

                        <Button Content="Módosítások mentése" Command="{Binding SaveEditCommand}" 
                                HorizontalAlignment="Right" Padding="30,12" Background="#1B5E20" Foreground="White" FontWeight="Bold"/>
                    </StackPanel>
                </ScrollViewer>

                <!-- ALSÓ GOMBOK (Mentés/Betöltés) -->
                <Border Grid.Row="1" Background="#F0F0F0" CornerRadius="0,0,10,10" Padding="15">
                    <Grid ColumnDefinitions="Auto, *, Auto, Auto">
                        <Button Grid.Column="0" Content="Adatok Betöltése" Click="OnLoadAll" Margin="0,0,10,0"/>
                        <Button Grid.Column="2" Content="Összes mentése" Click="OnSaveAll" Margin="0,0,10,0"/>
                        <Button Grid.Column="3" Content="Töröltek mentése (Szűrt)" Click="OnSaveDeleted" Background="#D32F2F" Foreground="White"/>
                    </Grid>
                </Border>
            </Grid>
        </Border>
    </Grid>
</Window>